
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 2rem;
    }
    #form-builder-panel {
      padding: 1rem;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .form-builder-toolbar {
      margin-bottom: 1rem;
    }
    .fieldset {
      border: 1px solid #aaa;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 4px;
      background: #fafafa;
    }
    .legend {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .label {
      display: block;
      margin-top: 0.5rem;
    }
    .input, .select {
      width: 100%;
      margin-top: 0.2rem;
      margin-bottom: 0.5rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    textarea {
      font-family: monospace;
      margin-top: 1rem;
    }
  </style>


<div id="form-builder-panel">
  <h2>üß± Form Builder 2</h2>
  <div class="form-builder-toolbar">
    <button onclick="addSection()">+ Add Section</button>
    <button onclick="exportForm()">üìÅ Export</button>
    <input type="file" onchange="importForm(event)" accept=".json"/>
  </div>

  <div id="builder-canvas"></div>

  <textarea id="form-json-output" style="width: 100%; height: 200px;"></textarea>
</div>

<script>
let form = {
  id: 'proposal-form-001',
  title: 'New Proposal Form',
  sections: []
};

function addSection() {
  const section = {
    id: `section-${form.sections.length + 1}`,
    title: 'New Section',
    fields: []
  };
  form.sections.push(section);
  renderBuilder();
}

function addField(sectionIndex, field) {
  form.sections[sectionIndex].fields.push(field);
  renderBuilder();
}

function renderBuilder() {
  const canvas = document.getElementById('builder-canvas');
  canvas.innerHTML = '';

  form.sections.forEach((section, sIdx) => {
    const fieldset = document.createElement('fieldset');
    fieldset.className = 'fieldset';
    fieldset.id = section.id;

    const legend = document.createElement('legend');
    legend.className = 'legend';
    legend.contentEditable = true;
    legend.innerText = section.title;
    legend.oninput = (e) => {
      form.sections[sIdx].title = e.target.innerText;
    };
    fieldset.appendChild(legend);

    section.fields.forEach((field, fIdx) => {
      const wrapper = document.createElement('div');
      wrapper.style.marginBottom = '0.5rem';

      const labelInput = document.createElement('input');
      labelInput.className = 'input';
      labelInput.type = 'text';
      labelInput.value = field.label || 'Field';
      labelInput.placeholder = 'Label';
      labelInput.oninput = (e) => {
        form.sections[sIdx].fields[fIdx].label = e.target.value;
        updateOutput();
      };

      const typeSelect = document.createElement('select');
      typeSelect.className = 'select';
      ['text', 'textarea', 'email', 'number', 'radio', 'checkbox'].forEach(type => {
        const opt = document.createElement('option');
        opt.value = type;
        opt.innerText = type;
        if (type === field.type) opt.selected = true;
        typeSelect.appendChild(opt);
      });
      typeSelect.onchange = (e) => {
        form.sections[sIdx].fields[fIdx].type = e.target.value;
        updateOutput();
      };

      wrapper.appendChild(labelInput);
      wrapper.appendChild(typeSelect);
      fieldset.appendChild(wrapper);
    });

    const addFieldBtn = document.createElement('button');
    addFieldBtn.textContent = '+ Add Field';
    addFieldBtn.type = 'button';
    addFieldBtn.onclick = () => {
      const newField = {
        tag: 'input',
        type: 'text',
        label: 'New Field',
        required: false
      };
      addField(sIdx, newField);
    };
    fieldset.appendChild(addFieldBtn);

    canvas.appendChild(fieldset);
  });

  updateOutput();
}

function updateOutput() {
  document.getElementById('form-json-output').value = JSON.stringify(form, null, 2);
}

function exportForm() {
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(form, null, 2));
  const downloadAnchorNode = document.createElement('a');
  downloadAnchorNode.setAttribute("href", dataStr);
  downloadAnchorNode.setAttribute("download", `${form.id}.json`);
  document.body.appendChild(downloadAnchorNode);
  downloadAnchorNode.click();
  downloadAnchorNode.remove();
}

function importForm(event) {
  const reader = new FileReader();
  reader.onload = (e) => {
    form = JSON.parse(e.target.result);
    renderBuilder();
  };
  reader.readAsText(event.target.files[0]);
}

// Initial render
renderBuilder();
</script>

